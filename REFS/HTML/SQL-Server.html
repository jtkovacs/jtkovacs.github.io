<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <meta content="text/css" http-equiv="Content-Style-Type"/>
  <meta content="pandoc" name="generator"/>
  <title>
  </title>
  <link href="refs.css" rel="stylesheet" type="text/css"/>
  <style type="text/css">
   div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
 </head>
 <body>
  <p id="path">
   <a href="../../pkb.html">
    https://jtkovacs.github.io/pkb.html
   </a>
   &gt;
   <a href="https://jtkovacs.github.io/REFS/HTML/SQL-Server.html">
    https://jtkovacs.github.io/REFS/HTML/SQL-Server.html
   </a>
   &gt; 797 words
  </p>
  <table class="TOC">
   <tr>
    <td>
     <ul>
      <li>
       <a href="#sql-server-configuration-manager-">
        SQL Server Configuration Manager
       </a>
      </li>
      <li>
       <a href="#sql-server-management-studio">
        SQL Server Management Studio
       </a>
       <ul>
        <li>
         <a href="#manage-databases">
          Manage databases
         </a>
        </li>
        <li>
         <a href="#manage-schemas">
          Manage schemas
         </a>
        </li>
        <li>
         <a href="#manage-tables-">
          Manage tables
         </a>
         <ul>
          <li>
           <a href="#datatypes">
            Datatypes
           </a>
          </li>
          <li>
           <a href="#temporal-tables">
            Temporal tables
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#manage-performance">
          Manage performance
         </a>
         <ul>
          <li>
           <a href="#splitting-the-database">
            Splitting the database
           </a>
          </li>
          <li>
           <a href="#creating-indexes">
            Creating indexes
           </a>
          </li>
          <li>
           <a href="#fixing-index-fragmentation">
            Fixing index fragmentation
           </a>
          </li>
          <li>
           <a href="#creating-memory-optimized-tables">
            Creating memory-optimized tables
           </a>
          </li>
         </ul>
        </li>
        <li>
         <a href="#manage-views">
          Manage views
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#sources">
        Sources
       </a>
       <ul>
        <li>
         <a href="#cited">
          Cited
         </a>
        </li>
        <li>
         <a href="#references">
          References
         </a>
        </li>
        <li>
         <a href="#read">
          Read
         </a>
        </li>
        <li>
         <a href="#unread">
          Unread
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </td>
   </tr>
  </table>
  <h1>
   <a name="sql-server-configuration-manager">
    SQL Server Configuration Manager
   </a>
  </h1>
  <p>
   Shows every instance of a SQL Server product on a machine; lets you restart a process and enable protocols for communication between client &amp; server.
  </p>
  <h1>
   <a name="sql-server-management-studio">
    SQL Server Management Studio
   </a>
  </h1>
  <ul>
   <li>
    <strong>
     Activity Monitor:
    </strong>
    use for identifying bottlenecks &amp; kill process if needed (but might cause data corruption!)
   </li>
   <li>
    <strong>
     SQL Server Profiler:
    </strong>
    lets you start a trace for ongoing tracking of activity; can specify activities of interest in detail
   </li>
   <li>
    <strong>
     Syntax legend:
    </strong>
    <a href="https://docs.microsoft.com/en-us/sql/t-sql/language-elements/transact-sql-syntax-conventions-transact-sql">
     how to interpret syntax documentation of T-SQL commands
    </a>
   </li>
  </ul>
  <h2>
   <a name="manage-databases">
    Manage databases
   </a>
  </h2>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">DATABASE</span> dbname

<span class="kw">USE</span> SQLservername.databasename.schemaname.tablename</code></pre>
  </div>
  <h2>
   <a name="manage-schemas">
    Manage schemas
   </a>
  </h2>
  <ul>
   <li>
    <a class="uri" href="https://stackoverflow.com/questions/1062075/why-do-table-names-in-sql-server-start-with-dbo">
     https://stackoverflow.com/questions/1062075/why-do-table-names-in-sql-server-start-with-dbo
    </a>
   </li>
   <li>
    <a class="uri" href="http://www.sqlteam.com/article/understanding-the-difference-between-owners-and-schemas-in-sql-server">
     http://www.sqlteam.com/article/understanding-the-difference-between-owners-and-schemas-in-sql-server
    </a>
   </li>
  </ul>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">SCHEMA</span> sname <span class="kw">AUTHORIZATION</span> [dbo]</code></pre>
  </div>
  <h2>
   <a name="manage-tables">
    Manage tables
   </a>
  </h2>
  <ul>
   <li>
    <strong>
     Create PK:
    </strong>
    Right click table &gt; Design &gt; Select field, click key icon &gt; In column properties window, change Identity Specification to “yes”
   </li>
   <li>
    <strong>
     Filegroups:
    </strong>
    A database has a default PRIMARY filegroup but you can create other filegroups, e.g. to hold tables that should be read-only.
   </li>
   <li>
    <strong>
     Inspect relationships:
    </strong>
    <ul>
     <li>
      [Database] &gt; [Table] &gt; Keys
     </li>
     <li>
      [Database] &gt; Database diagrams
     </li>
    </ul>
   </li>
  </ul>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> tname 
    (
    fieldname IDENTITY(seed, <span class="kw">increment</span>), 
    fielddname datatype, 
    ... 
    ) 
    <span class="kw">ON</span> Filegroupname;
    
<span class="co">-- Add field to existing table</span>
<span class="kw">CREATE</span></code></pre>
  </div>
  <h3>
   <a name="datatypes">
    Datatypes
   </a>
  </h3>
  <p>
   <a href="https://docs.microsoft.com/en-us/sql/t-sql/data-types/data-types-transact-sql">
    Details here;
   </a>
   also note that SQL Server's data types are
   <a href="https://docs.microsoft.com/en-us/sql/t-sql/data-types/data-type-synonyms-transact-sql">
    mapped to ISO standard data types.
   </a>
  </p>
  <ul>
   <li>
    <strong>
     Exact numeric:
    </strong>
    NUMERIC, BIGINT, INT, SMALLINT, TINYINT, DECIMAL, BIT, MONEY, SMALLMONEY
   </li>
   <li>
    <strong>
     Approximate numeric:
    </strong>
    FLOAT, REAL
   </li>
   <li>
    <strong>
     Date and time:
    </strong>
    DATE, TIME, DATETIME, DATETIME2, DATETIMEOFFSET, SMALLDATETIME
   </li>
   <li>
    <strong>
     Character:
    </strong>
    CHAR, VARCHAR, TEXT
    <ul>
     <li>
      <strong>
       Unicode character:
      </strong>
      NCHAR, NVARCHAR, NTEXT
     </li>
    </ul>
   </li>
   <li>
    <strong>
     Binary:
    </strong>
    BINARY, IMAGE, VARBINARY
   </li>
   <li>
    <strong>
     Special purpose:
    </strong>
    CURSOR, HIERARCHYID, SQL_VARIANT, TABLE, TIMESTAMP, UNIQUEIDENTIFIER, XML
    <ul>
     <li>
      <a href="https://docs.microsoft.com/en-us/sql/relational-databases/spatial/spatial-data-types-overview">
       Spatial data types
      </a>
     </li>
    </ul>
   </li>
  </ul>
  <h3>
   <a name="temporal-tables">
    Temporal tables
   </a>
  </h3>
  <p>
   Temporal tables (only SQL Server 2016) automatically maintain the history of the table, which can then be queried. The fields ValidFrom, ValidTo, and PERIOD FOR SYSTEM_TIME are required:
  </p>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> Inventory ([InventoryID] <span class="dt">int</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">PRIMARY</span> <span class="kw">KEY</span> CLUSTERED, 
[ItemName] <span class="dt">nvarchar</span>(<span class="dv">100</span>) <span class="kw">NOT</span> <span class="kw">NULL</span>, 
[ValidFrom] datetime2 (<span class="dv">2</span>) <span class="kw">GENERATED</span> ALWAYS <span class="kw">AS</span> <span class="kw">ROW</span> <span class="kw">START</span>, 
[ValidTo] datetime2 (<span class="dv">2</span>) <span class="kw">GENERATED</span> ALWAYS <span class="kw">AS</span> <span class="kw">ROW</span> <span class="kw">END</span>, 
PERIOD <span class="kw">FOR</span> SYSTEM_TIME (ValidFrom, ValidTo))    
<span class="kw">WITH</span> (SYSTEM_VERSIONING = <span class="kw">ON</span>); 

<span class="kw">SELECT</span> [StockItemName]
<span class="kw">FROM</span> [WideWorldImporters].[Warehouse].[StockItems]
<span class="kw">FOR</span> SYSTEM_TIME <span class="kw">AS</span> <span class="kw">OF</span> <span class="st">'2015-01-01'</span>
<span class="kw">WHERE</span> StockItemName <span class="kw">like</span> <span class="st">'%shark%'</span></code></pre>
  </div>
  <h2>
   <a name="manage-performance">
    Manage performance
   </a>
  </h2>
  <h3>
   <a name="splitting-the-database">
    Splitting the database
   </a>
  </h3>
  <p>
   Installing logs and data on different drives gives a performance boost.
  </p>
  <h3>
   <a name="creating-indexes">
    Creating indexes
   </a>
  </h3>
  <p>
   Recall that PKs are indexed automatically.
  </p>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- Covering index</span>
<span class="kw">CREATE</span> NONCLUSTERED <span class="kw">INDEX</span> IX_Address_PostalCode <span class="co">-- give index a name</span>
<span class="kw">ON</span> Person.Address (PostalCode) <span class="co">-- specify table and key</span>
INCLUDE (AddressLine1, AddressLine2, City, StateProvinceID); <span class="co">-- add other fields</span>

<span class="co">-- Filtered index</span>
<span class="kw">CREATE</span> NONCLUSTERED <span class="kw">INDEX</span> DesignEngineer
<span class="kw">ON</span> HumanResources.Employee (BusinessEntityID);
<span class="kw">WHERE</span> JobTitle = <span class="st">'Design Engineer'</span> <span class="co">-- filter</span>

<span class="co">-- Columnstore index</span>
<span class="kw">CREATE</span> NONCLUSTERED COLUMNSTORE <span class="kw">INDEX</span> csindx_simple 
<span class="kw">ON</span> SimpleTable (OrderDateKey, DueDateKey, ShipDateKey) 
<span class="kw">WITH</span> (DROP_EXISTING =  <span class="kw">ON</span>, <span class="co">-- drops and rebuilds an existing index of the same name </span>
    MAXDOP = <span class="dv">2</span>) <span class="co">-- for parallel processing</span>
    <span class="kw">ON</span> <span class="ot">"default"</span>;</code></pre>
  </div>
  <h3>
   <a name="fixing-index-fragmentation">
    Fixing index fragmentation
   </a>
  </h3>
  <p>
   Fragmentation can be identified with
   <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql">
    sys.dm_db_index_physical_stats,
   </a>
   a SQL Server
   <a href="https://blogs.msdn.microsoft.com/sqlcan/2012/05/24/a-microsoft-sql-server-dmvdmf-cheat-sheet/">
    dynamic management function
   </a>
   <strong>
    (DMF):
   </strong>
  </p>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> * 
<span class="kw">FROM</span> sys.dm_db_index_physical_stats (   
    { database_id | <span class="kw">NULL</span> | <span class="dv">0</span> | <span class="kw">DEFAULT</span> }  
  , { object_id | <span class="kw">NULL</span> | <span class="dv">0</span> | <span class="kw">DEFAULT</span> }  
  , { index_id | <span class="kw">NULL</span> | <span class="dv">0</span> | -<span class="dv">1</span> | <span class="kw">DEFAULT</span> }  
  , { partition_number | <span class="kw">NULL</span> | <span class="dv">0</span> | <span class="kw">DEFAULT</span> }  
  , { <span class="kw">mode</span> | <span class="kw">NULL</span> | <span class="kw">DEFAULT</span> | DETAILED | <span class="kw">SAMPLE</span> | LIMITED | }  
)

<span class="kw">SELECT</span> * 
<span class="kw">FROM</span> sys.dm_db_index_physical_stats (DB_ID(N<span class="st">'AdventureWorks'</span>), 
    OBJECT_ID(N<span class="st">'Person.Address'</span>), <span class="kw">NULL</span>, <span class="kw">NULL</span> , <span class="st">'DETAILED'</span>); 
<span class="co">-- Column **Avg_fragmentation_in_percent** depicts logical fragmentation</span>
<span class="co">-- Column **Avg_page_space_used_in_percent** depicts internal fragmentation</span></code></pre>
  </div>
  <p>
   Once identified, fragmentation can be repaired in the following ways:
  </p>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- Recreate </span>
<span class="kw">CREATE</span> <span class="kw">INDEX</span> <span class="kw">WITH</span> DROP_EXISTING;

<span class="co">-- Rebuild </span>
<span class="kw">ALTER</span> <span class="kw">INDEX</span> ... <span class="kw">REBUILD</span>;

<span class="co">-- Reorganize </span>
<span class="kw">ALTER</span> <span class="kw">INDEX</span> ... REORGANIZE </code></pre>
  </div>
  <h3>
   <a name="creating-memory-optimized-tables">
    Creating memory-optimized tables
   </a>
  </h3>
  <p>
   In-memory AKA
   <strong>
    memory-optimized tables
   </strong>
   are used to improve performance of read-write tables. The keyword
   <code>
    GO
   </code>
   causes preceding commands to be submitted as a batch, and
   <code>
    USE
   </code>
   ensures that the table is created within the right database:
  </p>
  <div class="sourceCode">
   <pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">ALTER</span> <span class="kw">DATABASE</span> dbname
<span class="kw">ADD</span> FILEGROUP fgname
CONTAINS MEMORY_OPTIMIZED_DATA;

<span class="kw">ALTER</span> <span class="kw">DATABASE</span> dbname
<span class="kw">ADD</span> <span class="kw">FILE</span> (Name = ‘fname’, Filename ‘fpath/fname’)
<span class="kw">TO</span> FILEGROUP fgname;

GO

<span class="kw">USE</span> dbname
GO

<span class="kw">CREATE</span> <span class="kw">TABLE</span> tname (fdname <span class="dt">INT</span> IDENTITY(<span class="dv">1</span>,<span class="dv">1</span>) <span class="kw">PRIMARY</span> <span class="kw">KEY</span> NONCLUSTERED, fdname, fdname)
<span class="kw">WITH</span> (MEMORY-OPTIMIZED=ON)</code></pre>
  </div>
  <h2>
   <a name="manage-views">
    Manage views
   </a>
  </h2>
  <ul>
   <li>
    <strong>
     Create view:
    </strong>
    [Database] &gt; [Views] &gt; right click. This is done to facilitate reporting, since data that is logically related (city and states) may be scattered across multiple tables; however, it create a penalty for writing data.
   </li>
   <li>
    <strong>
     Views can be made persistent to increase performance:
    </strong>
    right click view &gt; Script View as &gt; ALTER To &gt; New Query Editor Window &gt; Add “WITH SCHEMABINDING” under “ALTER VIEW” line &gt; Execute &gt; Refresh Object Explorer pane &gt; Right click on Indexes &gt; Clustered index &gt; Add columns.
   </li>
  </ul>
  <h1>
   <a name="sources">
    Sources
   </a>
  </h1>
  <h2>
   <a name="cited">
    Cited
   </a>
  </h2>
  <h2>
   <a name="references">
    References
   </a>
  </h2>
  <h2>
   <a name="read">
    Read
   </a>
  </h2>
  <h2>
   <a name="unread">
    Unread
   </a>
  </h2>
  <ul>
   <li>
    <a href="http://www.lynda.com/SQL-Server-tutorials/Database-Fundamentals-Core-Concepts/385693-2.html">
     Core Concepts for SQL Server
    </a>
   </li>
   <li>
    <a href="http://www.lynda.com/SQL-Server-tutorials/Database-Fundamentals-Storage/385694-2.html">
     Storage in SQL Server
    </a>
   </li>
   <li>
    <a href="http://www.lynda.com/SQL-Server-tutorials/Database-Fundamentals-Creating-Manipulating-Data/385697-2.html">
     Data Manipulation in SQL Server
    </a>
   </li>
  </ul>
 </body>
</html>
