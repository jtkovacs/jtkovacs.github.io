<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <meta content="text/css" http-equiv="Content-Style-Type"/>
  <meta content="pandoc" name="generator"/>
  <title>
  </title>
  <link href="refs.css" rel="stylesheet" type="text/css"/>
  <style type="text/css">
   div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
 </head>
 <body>
  <p id="path">
   <a href="../../pkb.html">
    https://jtkovacs.github.io/pkb.html
   </a>
   &gt;
   <a href="https://jtkovacs.github.io/REFS/HTML/wrangling.html">
    https://jtkovacs.github.io/REFS/HTML/wrangling.html
   </a>
  </p>
  <table class="TOC">
   <tr>
    <td>
     <ul>
      <li>
       <a href="#i/o">
        I/O
       </a>
       <ul>
        <li>
         <a href="#...-to-database-via-peewee-orm">
          ... to database via Peewee ORM
         </a>
        </li>
       </ul>
      </li>
      <li>
       <a href="#data-wrangling">
        Data wrangling
       </a>
      </li>
     </ul>
    </td>
   </tr>
  </table>
  <h1>
   <a name="i/o">
    I/O
   </a>
  </h1>
  <ul>
   <li>
    <a href="https://teamtreehouse.com/library/using-databases-in-python">
     Treehouse - Using Databases in Python
    </a>
   </li>
   <li>
    <a class="uri" href="https://docs.python.org/3/tutorial/inputoutput.html">
     https://docs.python.org/3/tutorial/inputoutput.html
    </a>
   </li>
  </ul>
  <div class="sourceCode">
   <pre class="sourceCode python"><code class="sourceCode python"><span class="co"># to read or write binary (raw 8-bit):</span>
<span class="cf">with</span> <span class="bu">open</span>(<span class="st">'filename'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f: 
f.write(os.urandom(<span class="dv">10</span>))

<span class="cf">with</span> <span class="bu">open</span>(<span class="st">'filename'</span>, <span class="st">'rb'</span>) <span class="im">as</span> f: 
f.read()

<span class="bu">open</span>(<span class="bu">file</span>, mode<span class="op">=</span><span class="st">'r'</span>, buffering<span class="op">=-</span><span class="dv">1</span>, encoding<span class="op">=</span><span class="va">None</span>, errors<span class="op">=</span><span class="va">None</span>, newline<span class="op">=</span><span class="va">None</span>, closefd<span class="op">=</span><span class="va">True</span>, opener<span class="op">=</span><span class="va">None</span>)
<span class="co"># https://docs.python.org/3/library/functions.html</span>


<span class="co"># https://docs.python.org/3/howto/urllib2.html</span>
<span class="co"># download from url: </span>
<span class="im">import</span> urllib2
ftxt <span class="op">=</span> urllib2.urlopen(“target_url”).read()

<span class="co"># store user input: </span>
<span class="co"># Python 2:</span>
vname <span class="op">=</span> <span class="bu">raw_input</span>(<span class="st">'What is your name?</span><span class="ch">\n</span><span class="st">'</span>)
age <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(<span class="st">"What is your age?"</span>)
long_text <span class="op">=</span> sys.stdin.read().strip()
<span class="co"># type ctrl+d for EOF</span>
<span class="co"># Python 3:</span>
vname <span class="op">=</span> <span class="bu">input</span>(<span class="st">'What is your name?'</span>)
age <span class="op">=</span> <span class="bu">int</span>(<span class="bu">input</span>(‘What <span class="op">is</span> your age? ‘)

<span class="co"># open text file, read single line, remove from memory: </span>
fhand <span class="op">=</span> <span class="bu">open</span>(‘filename.txt’, encoding<span class="op">=</span>’utf<span class="dv">-8</span>’)
fhand.readline() 
fhand.close()

<span class="co"># load small text file into string: </span>
str_name <span class="op">=</span> fhand.read(<span class="co">#bytes)</span>

<span class="co"># load large text file into list: </span>
l_name <span class="op">=</span> fhand.readlines()

<span class="co"># load text file into pandas dataframe:</span>
<span class="im">from</span> pandas <span class="im">import</span> DataFrame, Series
<span class="im">import</span> pandas <span class="im">as</span> pd
frame<span class="op">=</span>DataFrame(<span class="bu">open</span>(‘<span class="op">/</span><span class="bu">file</span><span class="op">/</span>path.txt’))

<span class="co"># fetch through API: uses urllib2, json, pandas</span>
<span class="co"># https://github.com/katychuang/python-data-sci-basics/blob/master/teachers_notes/api_example.py</span>

<span class="co"># open csv with context manager pattern, load into list: </span>
<span class="im">import</span> csv
<span class="cf">with</span> <span class="bu">open</span>(filename,encoding<span class="op">=</span>’utf<span class="dv">-8</span>’) <span class="im">as</span> file_in:
my_reader <span class="op">=</span> csv.reader(file_in,delimiter<span class="op">=</span>’<span class="op">\</span>t’)
data <span class="op">=</span> <span class="bu">list</span>(my_reader)

<span class="co"># load csv into dict &amp; read dict: </span>
<span class="cf">with</span> <span class="bu">open</span>(filename,encoding<span class="op">=</span>’utf<span class="dv">-8</span>’) <span class="im">as</span> file_in:
my_reader <span class="op">=</span> csv.DictReader(file_in,delimiter<span class="op">=</span>’<span class="op">\</span>t’) 
data[‘field name’] <span class="co"># retrieve data by column name</span>

<span class="co"># load csv into array: </span>
my_array <span class="op">=</span> np.genfromtxt(fname,delimiter<span class="op">=</span>’<span class="op">\</span>t’,dtypes<span class="op">=</span><span class="va">None</span>)

<span class="co"># open JSON: </span>
<span class="im">import</span> json
<span class="cf">with</span> <span class="bu">open</span>(‘filename.json’) <span class="im">as</span> myfile:
<span class="bu">file</span> <span class="op">=</span> json.load(myfile) <span class="co"># load chooses the closest Python object</span>

<span class="co"># load file into list of dicts using json ’load string’ and a list comprehension:</span>
records <span class="op">=</span> [json.loads(line) <span class="cf">for</span> line <span class="op">in</span> <span class="bu">open</span>(‘<span class="op">/</span><span class="bu">file</span><span class="op">/</span>path.txt’,’rb’)

<span class="bu">print</span>(<span class="op">*</span>objects, sep<span class="op">=</span><span class="st">' '</span>, end<span class="op">=</span><span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, <span class="bu">file</span><span class="op">=</span>sys.stdout, flush<span class="op">=</span><span class="va">False</span>)

<span class="co"># output to screen: </span>
<span class="bu">print</span>(vname) <span class="op">or</span> <span class="bu">print</span> vname

<span class="co"># create reusable message: </span>
message <span class="op">=</span> ’There are {it} items’ 
<span class="bu">print</span>(message.<span class="bu">format</span>(it<span class="op">=</span>nr_items)

<span class="co"># print columns</span>
<span class="bu">print</span>(state,’<span class="op">\</span>t’,count)

<span class="co"># specify display of decimals: </span>
<span class="bu">print</span>(‘Price: ${:<span class="fl">03.</span>2f}’.<span class="bu">format</span>(price))

<span class="co"># add linebreak: </span>
<span class="bu">print</span>(‘Hello <span class="op">\</span>n world<span class="op">!</span>’)

<span class="co"># clear screen: </span>
os.system(‘cls’ <span class="cf">if</span> os_name <span class="op">==</span> ‘nt’ <span class="cf">else</span> ‘clear’)

<span class="co"># output to text: </span>
<span class="co"># CAUTION: opening existing file with ‘w’ will erase its contents; instead, use ‘a’</span>
fout <span class="op">=</span> <span class="bu">open</span>(<span class="st">'output.txt'</span>, <span class="st">'w'</span>)

<span class="co"># add content to new file: </span>
fout.write(line)
<span class="co"># save and close file: </span>
fout.close()

<span class="co"># output to pdf:</span>
<span class="im">from</span> matplotlib.backends.backend_pdf <span class="im">import</span> PdfPages
pp <span class="op">=</span> PdfPages(<span class="st">'foo.pdf'</span>)
pp.savefig()pp.close()

<span class="co"># https://openpyxl.readthedocs.io/en/default/</span>
<span class="im">import</span> openpyxl
output to excel: save_spreadsheet(“filename”, my_data)

<span class="co"># output to csv: see also unicodecsv</span>
numpy.savetxt(<span class="st">"filename"</span>, my_data, delimiter<span class="op">=</span><span class="st">","</span>, fmt<span class="op">=</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span>)
<span class="cf">with</span> <span class="bu">open</span>(‘filename’, ‘a’) <span class="im">as</span> myfile:
fnames <span class="op">=</span> [l’A’, ‘B’, ‘C’]
filewriter <span class="op">=</span> csv.DictWriter(myfile, fieldnames <span class="op">=</span> fnames)
filewriter <span class="op">=</span> writerheader()
filewriter <span class="op">=</span> writerow({‘A’: <span class="dv">1</span>, ‘B’:<span class="dv">2</span>, ‘C’:<span class="dv">3</span>})

<span class="co"># output to JSON:</span>
<span class="co"># output to string: </span>
json.dumps(my_list)
<span class="co"># output to file:</span>
<span class="cf">with</span> <span class="bu">open</span>(‘filename.json’, ‘a’) <span class="im">as</span> my_file:
json.dump(list_of_dicts, my_file)</code></pre>
  </div>
  <h2>
   <a name="...-to-database-via-peewee-orm">
    ... to database via Peewee ORM
   </a>
  </h2>
  <div class="sourceCode">
   <pre class="sourceCode python"><code class="sourceCode python">pip install peewee
<span class="im">from</span> peewee <span class="im">import</span> <span class="op">*</span>

<span class="co"># create &amp; connect to database:</span>
db <span class="op">=</span> SqliteDatabase(‘dbname.db’)
psql_db <span class="op">=</span> PostgresqlDatabase(<span class="st">'my_database'</span>, user<span class="op">=</span><span class="st">'postgres'</span>)
mysql_db <span class="op">=</span> MySQLDatabase(<span class="st">'my_database'</span>)

<span class="co"># special Python classes called models correspond to tables; </span>
<span class="co"># specific models inherit from the Model class:</span>
<span class="kw">class</span> Student(Model):
username <span class="op">=</span> CharField(maxlength<span class="op">=</span><span class="dv">255</span>, unique<span class="op">=</span><span class="va">True</span>)
points <span class="op">=</span> IntegerField(default<span class="op">=</span><span class="dv">0</span>)
date <span class="op">=</span> DateTimeField(datetime.datetime.now) <span class="co"># important to omit parantheses in this datetime function call</span>

<span class="kw">class</span> Meta():
database <span class="op">=</span> db
<span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> ‘__main__’: 
db.<span class="ex">connect</span>()
db.create_tables([Student], safe<span class="op">=</span><span class="va">True</span>)
field types: CharField, IntegerField, TextField, DateTimeFieldfield characteristics: max_length, default, unique

<span class="co"># enter new data: </span>
Student.create(username<span class="op">=</span>student[unm], points<span class="op">=</span> student[pts])

<span class="co"># update existing data:</span>
record <span class="op">=</span> Student.get(username<span class="op">=</span>student[unm]) → record.points <span class="op">=</span> student[pts] → record.save()
Student.update(points<span class="op">=</span>student[<span class="st">'points'</span>]). where(Student.username <span class="op">==</span> student[<span class="st">'username'</span>]).execute()

<span class="co"># find/filter records in table: </span>
Student.select().order_by(Student.points.desc())
Entry.select().where(Entry.content.contains(search_query), Entry.Date <span class="op">==</span> date)

<span class="co"># delete single record: </span>
Student.delete_instance(condition)
single_row.delete_instance()

<span class="co"># close connection: </span>
db.close()

<span class="co"># ordered dict can be useful:</span>
<span class="im">from</span> collections <span class="im">import</span> OrderedDict
menu <span class="op">=</span> OrderedDict([(‘a’, ‘add_entry’), (‘v’, ‘view_entries’)])
returns doc string <span class="cf">for</span> function: function_name.__doc__</code></pre>
  </div>
  <h1>
   <a name="data-wrangling">
    Data wrangling
   </a>
  </h1>
  <p>
   Searching, counting, ranking, grouping, handling whitespace
  </p>
  <p>
   https://docs.python.org/3.5/library/markup.html
  </p>
  <div class="sourceCode">
   <pre class="sourceCode python"><code class="sourceCode python"><span class="co"># to check for an empty list, avoid (if len(my_list) == 0)</span>
<span class="co"># prefer this approach:</span>
<span class="kw">def</span> check_list_for_members(my_list):
    <span class="cf">if</span> <span class="op">not</span> my_list:
        <span class="bu">print</span>(<span class="st">"Sorry, that's an empty list"</span>)
    <span class="cf">else</span>: 
        <span class="cf">pass</span></code></pre>
  </div>
  <ul>
   <li>
    <a class="uri" href="http://nbviewer.jupyter.org/urls/gist.githubusercontent.com/TomAugspurger/6e052140eaa5fdb6e8c0/raw/811585624e843f3f80b9b6fe89e18119d7d2d73c/dplyr_pandas.ipynb">
     http://nbviewer.jupyter.org/urls/gist.githubusercontent.com/TomAugspurger/6e052140eaa5fdb6e8c0/raw/811585624e843f3f80b9b6fe89e18119d7d2d73c/dplyr_pandas.ipynb
    </a>
   </li>
   <li>
    <a class="uri" href="http://www.alfredo.motta.name/data-manipulation-primitives-in-r-and-python/">
     http://www.alfredo.motta.name/data-manipulation-primitives-in-r-and-python/
    </a>
   </li>
   <li>
    <a class="uri" href="https://docs.python.org/3/howto/sorting.html">
     https://docs.python.org/3/howto/sorting.html
    </a>
   </li>
  </ul>
  <div class="sourceCode">
   <pre class="sourceCode python"><code class="sourceCode python"><span class="bu">reversed</span>(seq)
<span class="bu">sorted</span>(iterable[, key][, reverse])

<span class="bu">zip</span>(<span class="op">*</span>iterables)
<span class="co"># Make an iterator that aggregates elements from each of the iterables.</span>

<span class="co"># search file contents: </span>
<span class="cf">for</span> line <span class="op">in</span> fhand:
line <span class="op">=</span> line.rstrip()   <span class="co"># remove whitespace</span>
<span class="cf">if</span> line.startswith(‘From:<span class="st">'): print line</span>
<span class="st"># search more efficiently:</span>
<span class="st">for line in fhand:</span>
<span class="st">line = line.rstrip()</span>
<span class="st">if not line.startswith('</span>From:<span class="st">') : continue </span>
<span class="st">print line</span>

<span class="st"># find specific string: </span>
<span class="st">for line in fhand:</span>
<span class="st">line = line.rstrip()</span>
<span class="st">if line.find('</span>desired string<span class="st">') == -1 :  continue</span>
<span class="st">print line</span>

<span class="st"># troubleshooting  whitespace errors: print repr(strname)</span>
<span class="st">inspect pandas dataframe: frame.info()</span>

<span class="st"># count w/ standard library</span>
<span class="st">from collections import defaultdict</span>
<span class="st">def get_counts(data):</span>
<span class="st">counts=defaultdict(int) # initialize to 0</span>
<span class="st">for x in data:</span>
<span class="st">counts[x]+=1</span>
<span class="st">return counts</span>

<span class="st"># rank w/ standard library</span>
<span class="st">from collections import Counter</span>
<span class="st">counts = Counter(data)</span>
<span class="st">counts.most_common(10)</span>

<span class="st"># count w/ pandas</span>
<span class="st">item_counts = frame[‘item’].value_counts()</span>

<span class="st"># clean w/ pandas</span>
<span class="st">clean_field = frame[‘field’].fillna(‘Missing’)</span>
<span class="st">clean_field[clean_field==’’] = ‘Unknown’</span>
<span class="st">clean_frame = framep[frame.a.notnull()]</span>

<span class="st"># plot</span>
<span class="st">item_counts.plot(kind=’barh’,rot=0)</span>

<span class="st"># numpy search for text in frame</span>
<span class="st">result = np.where(clean_frame[field].str.contains(‘text’),’Group 1’, ‘ Group 2’)</span>
<span class="st"># Binary labeling: Group 1 where contains text, Group 2 otherwise</span>

<span class="st"># group &amp; rank  results</span>
<span class="st">results_by_group = clean_frame.groupby([field,result])</span>
<span class="st">group_counts = results_by_group.size().unstack().fillna(0)</span>
<span class="st">indexer=group_counts.sum(1).argsort()</span>
<span class="st">count_subset=group_counts.take(indexer)[-10:]</span></code></pre>
  </div>
 </body>
</html>
